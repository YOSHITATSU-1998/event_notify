<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>æ‰‹å‹•ã‚¤ãƒ™ãƒ³ãƒˆè¿½åŠ  - ç¦å²¡ã‚¤ãƒ™ãƒ³ãƒˆæƒ…å ±</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .hidden { display: none; }
        .form-group {
            margin: 20px 0;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }
        input, select, textarea {
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            box-sizing: border-box;
        }
        input:focus, select:focus, textarea:focus {
            border-color: #007cba;
            outline: none;
        }
        button {
            background: #007cba;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }
        button:hover {
            background: #005a8b;
        }
        .auth-section {
            text-align: center;
        }
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            border: 1px solid #c3e6cb;
        }
        .error-message {
            color: #dc3545;
            margin-top: 10px;
            font-weight: bold;
        }
        .json-output {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .copy-button {
            background: #28a745;
            margin-top: 10px;
        }
        .copy-button:hover {
            background: #218838;
        }
        small {
            color: #6c757d;
            font-size: 14px;
        }
        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: #007cba;
            text-decoration: none;
        }
        .back-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">â† ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</a>
        
        <h1>ğŸª æ‰‹å‹•ã‚¤ãƒ™ãƒ³ãƒˆè¿½åŠ </h1>
        
        <!-- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div id="auth-section" class="auth-section">
            <h3>ğŸ” ç®¡ç†è€…èªè¨¼</h3>
            <p>ã‚¤ãƒ™ãƒ³ãƒˆæƒ…å ±ã‚’æ‰‹å‹•ã§è¿½åŠ ã™ã‚‹ã«ã¯èªè¨¼ãŒå¿…è¦ã§ã™</p>
            <div class="form-group">
                <input type="password" id="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">
                <button onclick="authenticate()">ãƒ­ã‚°ã‚¤ãƒ³</button>
            </div>
            <div id="auth-error" class="error-message"></div>
        </div>
        
        <!-- ãƒ•ã‚©ãƒ¼ãƒ ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆåˆæœŸçŠ¶æ…‹ï¼šéè¡¨ç¤ºï¼‰ -->
        <div id="form-section" class="hidden">
            <h3>ğŸ“ ã‚¤ãƒ™ãƒ³ãƒˆæƒ…å ±å…¥åŠ›</h3>
            
            <div class="form-group">
                <label for="event-type">ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—:</label>
                <select id="event-type" onchange="toggleDateFields()">
                    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                    <option value="oneshot">å˜ç™ºã‚¤ãƒ™ãƒ³ãƒˆï¼ˆ1æ—¥ã®ã¿ï¼‰</option>
                    <option value="recurring">æœŸé–“æŒ‡å®šã‚¤ãƒ™ãƒ³ãƒˆï¼ˆè¤‡æ•°æ—¥ï¼‰</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="title">ã‚¤ãƒ™ãƒ³ãƒˆå:</label>
                <input type="text" id="title" placeholder="ä¾‹: æ”¾ç”Ÿå±‹">
            </div>
            
            <div class="form-group">
                <label for="venue">ä¼šå ´å:</label>
                <input type="text" id="venue" placeholder="ä¾‹: ç®±å´å®®">
            </div>
            
            <!-- å˜ç™ºã‚¤ãƒ™ãƒ³ãƒˆç”¨ -->
            <div id="oneshot-fields" class="hidden">
                <div class="form-group">
                    <label for="single-date">é–‹å‚¬æ—¥:</label>
                    <input type="date" id="single-date">
                </div>
            </div>
            
            <!-- æœŸé–“æŒ‡å®šã‚¤ãƒ™ãƒ³ãƒˆç”¨ -->
            <div id="recurring-fields" class="hidden">
                <div class="form-group">
                    <label for="start-date">é–‹å§‹æ—¥:</label>
                    <input type="date" id="start-date">
                </div>
                <div class="form-group">
                    <label for="end-date">çµ‚äº†æ—¥:</label>
                    <input type="date" id="end-date">
                </div>
            </div>
            
            <div class="form-group">
                <label for="time">æ™‚åˆ»ï¼ˆä»»æ„ï¼‰:</label>
                <input type="time" id="time">
                <small>ç©ºæ¬„ã®å ´åˆã€Œæ™‚åˆ»æœªå®šã€ã¨ã—ã¦è¡¨ç¤ºã•ã‚Œã¾ã™</small>
            </div>
            
            <div class="form-group">
                <label for="notes">å‚™è€ƒï¼ˆä»»æ„ï¼‰:</label>
                <textarea id="notes" rows="3" placeholder="è¿½åŠ æƒ…å ±ãŒã‚ã‚Œã°è¨˜å…¥ã—ã¦ãã ã•ã„"></textarea>
            </div>
            
            <button onclick="submitEvent()">ğŸš€ ã‚¤ãƒ™ãƒ³ãƒˆè¿½åŠ </button>
            
            <div id="success-message" class="success-message hidden"></div>
        </div>
    </div>

    <script>
        // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼
        function authenticate() {
            const password = document.getElementById('password').value;
            const correctPassword = 'PLACEHOLDER_PASSWORD'; // GitHub Actions ã§ç½®æ›ã•ã‚Œã‚‹
            
            if (password === correctPassword) {
                document.getElementById('auth-section').classList.add('hidden');
                document.getElementById('form-section').classList.remove('hidden');
                document.getElementById('auth-error').textContent = '';
            } else {
                document.getElementById('auth-error').textContent = 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™';
            }
        }
        
        // ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—ã«ã‚ˆã‚‹è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
        function toggleDateFields() {
            const eventType = document.getElementById('event-type').value;
            const oneshotFields = document.getElementById('oneshot-fields');
            const recurringFields = document.getElementById('recurring-fields');
            
            if (eventType === 'oneshot') {
                oneshotFields.classList.remove('hidden');
                recurringFields.classList.add('hidden');
            } else if (eventType === 'recurring') {
                oneshotFields.classList.add('hidden');
                recurringFields.classList.remove('hidden');
            } else {
                oneshotFields.classList.add('hidden');
                recurringFields.classList.add('hidden');
            }
        }
        
        // ã‚¤ãƒ™ãƒ³ãƒˆè¿½åŠ å‡¦ç†
        function submitEvent() {
            const eventType = document.getElementById('event-type').value;
            const title = document.getElementById('title').value;
            const venue = document.getElementById('venue').value;
            const time = document.getElementById('time').value || null;
            const notes = document.getElementById('notes').value || '';
            
            if (!eventType || !title || !venue) {
                alert('å¿…é ˆé …ç›®ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—ã€ã‚¤ãƒ™ãƒ³ãƒˆåã€ä¼šå ´åï¼‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            let eventData = {
                title: title,
                venue: venue,
                time: time,
                notes: notes,
                added_at: new Date().toISOString()
            };
            
            if (eventType === 'oneshot') {
                const date = document.getElementById('single-date').value;
                if (!date) {
                    alert('é–‹å‚¬æ—¥ã‚’é¸æŠã—ã¦ãã ã•ã„');
                    return;
                }
                eventData.date = date;
                generateJSON('oneshot', eventData);
            } else if (eventType === 'recurring') {
                const startDate = document.getElementById('start-date').value;
                const endDate = document.getElementById('end-date').value;
                if (!startDate || !endDate) {
                    alert('é–‹å§‹æ—¥ã¨çµ‚äº†æ—¥ã‚’é¸æŠã—ã¦ãã ã•ã„');
                    return;
                }
                if (startDate > endDate) {
                    alert('é–‹å§‹æ—¥ã¯çµ‚äº†æ—¥ã‚ˆã‚Šå‰ã®æ—¥ä»˜ã«ã—ã¦ãã ã•ã„');
                    return;
                }
                eventData.start_date = startDate;
                eventData.end_date = endDate;
                generateJSON('recurring', eventData);
            }
        }
        
        // JSONç”Ÿæˆãƒ»è¡¨ç¤º
        function generateJSON(type, eventData) {
            const jsonOutput = JSON.stringify([eventData], null, 2);
            
            // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
            const successMsg = document.getElementById('success-message');
            const timeDisplay = eventData.time ? eventData.time : 'æ™‚åˆ»æœªå®š';
            const dateDisplay = type === 'oneshot' 
                ? eventData.date 
                : `${eventData.start_date} ï½ ${eventData.end_date}`;
            
            successMsg.innerHTML = `
                <h4>âœ… ã‚¤ãƒ™ãƒ³ãƒˆæƒ…å ±ãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸï¼</h4>
                <p><strong>è¿½åŠ äºˆå®š:</strong> ${eventData.title} (${eventData.venue}) - ${dateDisplay} ${timeDisplay}</p>
                
                <h5>ğŸ“‹ æ¬¡ã®æ‰‹é †:</h5>
                <ol>
                    <li>ä¸‹ã®JSONã‚’ã‚³ãƒ”ãƒ¼</li>
                    <li><code>manual_events/${type}.json</code> ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã</li>
                    <li>æ—¢å­˜ã®é…åˆ—ã«è¿½åŠ ã™ã‚‹ã‹ã€æ–°è¦ä½œæˆ</li>
                    <li>dispatchå®Ÿè¡Œã§åæ˜ ç¢ºèª</li>
                </ol>
                
                <div class="json-output">${jsonOutput}</div>
                <button class="copy-button" onclick="copyToClipboard('${jsonOutput.replace(/'/g, "\\'")}')">ğŸ“‹ JSONã‚’ã‚³ãƒ”ãƒ¼</button>
                
                <p><small>ğŸ’¡ ãƒ’ãƒ³ãƒˆ: æ—¢å­˜ã®JSONãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹å ´åˆã¯ã€é…åˆ—å†…ã«è¿½åŠ ã—ã¦ãã ã•ã„</small></p>
            `;
            successMsg.classList.remove('hidden');
            
            // ãƒ•ã‚©ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
            resetForm();
        }
        
        // ãƒ•ã‚©ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
        function resetForm() {
            document.getElementById('event-type').value = '';
            document.getElementById('title').value = '';
            document.getElementById('venue').value = '';
            document.getElementById('single-date').value = '';
            document.getElementById('start-date').value = '';
            document.getElementById('end-date').value = '';
            document.getElementById('time').value = '';
            document.getElementById('notes').value = '';
            
            // æ—¥ä»˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’éè¡¨ç¤ºã«
            document.getElementById('oneshot-fields').classList.add('hidden');
            document.getElementById('recurring-fields').classList.add('hidden');
        }
        
        // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‚³ãƒ”ãƒ¼
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('JSONã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼\nmanual_events/ ãƒ•ã‚©ãƒ«ãƒ€ã®è©²å½“ãƒ•ã‚¡ã‚¤ãƒ«ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚');
            }).catch(() => {
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ä½œæˆã—ã¦ã‚³ãƒ”ãƒ¼
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('JSONã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼');
            });
        }
        
        // Enterã‚­ãƒ¼ã§ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼
        document.getElementById('password').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                authenticate();
            }
        });
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ä»Šæ—¥ã®æ—¥ä»˜ã‚’æœ€å°å€¤ã«è¨­å®š
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('single-date').min = today;
            document.getElementById('start-date').min = today;
            document.getElementById('end-date').min = today;
        });
    </script>
</body>
</html>
